<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  id="Definitions_1"
                  targetNamespace="http://bpmn.io/schema/bpmn"
                  exporter="Camunda Modeler"
                  exporterVersion="5.0.0">

  <bpmn:process id="approval-process" name="Approval Process" isExecutable="true">

    <!-- Start Event -->
    <bpmn:startEvent id="StartEvent_1" name="Request Submitted">
      <bpmn:outgoing>Flow_1</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- Review Task (User Task) -->
    <bpmn:userTask id="ReviewTask" name="Review Request"
                   camunda:assignee="${reviewer}"
                   camunda:candidateGroups="reviewers">
      <bpmn:incoming>Flow_1</bpmn:incoming>
      <bpmn:outgoing>Flow_2</bpmn:outgoing>
    </bpmn:userTask>

    <!-- Approval Gateway -->
    <bpmn:exclusiveGateway id="ApprovalGateway" name="Approved?">
      <bpmn:incoming>Flow_2</bpmn:incoming>
      <bpmn:outgoing>Flow_Approved</bpmn:outgoing>
      <bpmn:outgoing>Flow_Rejected</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- Approval Service Task -->
    <bpmn:serviceTask id="ApprovalTask" name="Process Approval"
                      camunda:delegateExpression="${approvalDelegate}">
      <bpmn:incoming>Flow_Approved</bpmn:incoming>
      <bpmn:outgoing>Flow_3</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- Rejection Service Task -->
    <bpmn:serviceTask id="RejectionTask" name="Process Rejection"
                      camunda:delegateExpression="${approvalDelegate}">
      <bpmn:incoming>Flow_Rejected</bpmn:incoming>
      <bpmn:outgoing>Flow_4</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- Notification Task (after approval) -->
    <bpmn:serviceTask id="NotifyApproval" name="Send Approval Notification"
                      camunda:delegateExpression="${notificationDelegate}">
      <bpmn:incoming>Flow_3</bpmn:incoming>
      <bpmn:outgoing>Flow_5</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- Notification Task (after rejection) -->
    <bpmn:serviceTask id="NotifyRejection" name="Send Rejection Notification"
                      camunda:delegateExpression="${notificationDelegate}">
      <bpmn:incoming>Flow_4</bpmn:incoming>
      <bpmn:outgoing>Flow_6</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- Merge Gateway -->
    <bpmn:exclusiveGateway id="MergeGateway">
      <bpmn:incoming>Flow_5</bpmn:incoming>
      <bpmn:incoming>Flow_6</bpmn:incoming>
      <bpmn:outgoing>Flow_7</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- End Event -->
    <bpmn:endEvent id="EndEvent_1" name="Process Complete">
      <bpmn:incoming>Flow_7</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="ReviewTask" />
    <bpmn:sequenceFlow id="Flow_2" sourceRef="ReviewTask" targetRef="ApprovalGateway" />
    <bpmn:sequenceFlow id="Flow_Approved" name="Yes" sourceRef="ApprovalGateway" targetRef="ApprovalTask">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approved == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_Rejected" name="No" sourceRef="ApprovalGateway" targetRef="RejectionTask">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approved == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_3" sourceRef="ApprovalTask" targetRef="NotifyApproval" />
    <bpmn:sequenceFlow id="Flow_4" sourceRef="RejectionTask" targetRef="NotifyRejection" />
    <bpmn:sequenceFlow id="Flow_5" sourceRef="NotifyApproval" targetRef="MergeGateway" />
    <bpmn:sequenceFlow id="Flow_6" sourceRef="NotifyRejection" targetRef="MergeGateway" />
    <bpmn:sequenceFlow id="Flow_7" sourceRef="MergeGateway" targetRef="EndEvent_1" />

  </bpmn:process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="approval-process">
      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="179" y="209" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ReviewTask_di" bpmnElement="ReviewTask">
        <dc:Bounds x="270" y="187" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ApprovalGateway_di" bpmnElement="ApprovalGateway" isMarkerVisible="true">
        <dc:Bounds x="425" y="202" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ApprovalTask_di" bpmnElement="ApprovalTask">
        <dc:Bounds x="530" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="RejectionTask_di" bpmnElement="RejectionTask">
        <dc:Bounds x="530" y="280" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="NotifyApproval_di" bpmnElement="NotifyApproval">
        <dc:Bounds x="690" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="NotifyRejection_di" bpmnElement="NotifyRejection">
        <dc:Bounds x="690" y="280" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="MergeGateway_di" bpmnElement="MergeGateway" isMarkerVisible="true">
        <dc:Bounds x="845" y="202" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1_di" bpmnElement="EndEvent_1">
        <dc:Bounds x="952" y="209" width="36" height="36" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
